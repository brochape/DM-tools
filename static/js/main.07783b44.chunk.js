(this["webpackJsonpdm-tools-ui"]=this["webpackJsonpdm-tools-ui"]||[]).push([[0],{107:function(e,t){},168:function(e,t,n){},169:function(e,t,n){},197:function(e,t){},198:function(e,t){},199:function(e,t){},200:function(e,t){},201:function(e,t){},209:function(e,t,n){},213:function(e,t){},215:function(e,t){},226:function(e,t){},228:function(e,t){},255:function(e,t){},257:function(e,t){},258:function(e,t){},263:function(e,t){},265:function(e,t){},284:function(e,t){},296:function(e,t){},299:function(e,t){},302:function(e,t,n){},303:function(e,t,n){},304:function(e,t,n){},305:function(e,t,n){},306:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"setPage",(function(){return l})),n.d(a,"addCharSheet",(function(){return d})),n.d(a,"setCharSheets",(function(){return f}));var c,r=n(3),o=n(156),s=n.n(o);n(168),n(169);!function(e){e[e.ROLL_DICE=0]="ROLL_DICE",e[e.CHARACTER_SHEETS=1]="CHARACTER_SHEETS",e[e.VIDEO=2]="VIDEO"}(c||(c={}));var i=n(32),u={title:"My App",currentPage:c.ROLL_DICE,characterSheets:new Map},l=function(e,t){e.state.currentPage=t},d=function(e,t){var n=e.state;console.log("adding entry"),n.characterSheets=new Map(n.characterSheets).set(t.charName,t.charSheet)},f=function(e,t){e.state.characterSheets=t},h={state:u,actions:a},j=Object(i.d)(),p=(Object(i.f)(),Object(i.b)(),Object(i.c)(),Object(i.e)(),n(18)),b=n(16),O=n(158),m=n.n(O),g=(n(209),n(2)),x=function(){var e,t=j(),n=t.state,a=t.actions,c=Object(r.useState)(""),o=Object(b.a)(c,2),s=o[0],i=o[1],u=function(e){var t=e.target.textContent;t&&i(n.characterSheets.get(t)||"")},l=[],d=Object(p.a)(n.characterSheets);try{for(d.s();!(e=d.n()).done;){var f=e.value,h=Object(b.a)(f,1)[0];l.push(Object(g.jsx)("button",{className:"charButton",onClick:u,children:h},"char "+h))}}catch(O){d.e(O)}finally{d.f()}Object(r.useEffect)((function(){if(0===n.characterSheets.size){var e=window.localStorage.getItem("DM-tool-chars"),t=new Map;e&&(t=JSON.parse(e)),console.log("Reset chars"),a.setCharSheets(t)}}),[]);return Object(g.jsxs)("div",{className:"mainPage",children:[Object(g.jsxs)("div",{className:"charButtons",children:[l,Object(g.jsx)("input",{id:"pdfUploadButton",type:"file",className:"charButton"}),Object(g.jsx)("input",{id:"charName",type:"text"}),Object(g.jsx)("button",{onClick:function(){var e,t=(null===(e=document)||void 0===e?void 0:e.getElementById("pdfUploadButton")).files,c=document.getElementById("charName").value;if(t&&t.length>0){var r,o=t[0],s=new FileReader;s.onload=function(e){var t;r=null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.result,console.log("Before",n.characterSheets),a.addCharSheet({charName:c,charSheet:r.replace("data:application/pdf;base64,","")})},s.readAsDataURL(o)}},className:"charButton",children:"+"})]}),""!==s?Object(g.jsx)("div",{className:"pdfViewer",children:Object(g.jsx)(m.a,{document:{base64:s},scale:1.2,scaleStep:.5,maxScale:5,minScale:.5,hideRotation:!0})}):null]})},v=n(159),S=(n(302),function(){var e=Object(r.useState)(""),t=Object(b.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),o=Object(b.a)(c,2),s=o[0],i=o[1],u=Object(r.useState)(""),l=Object(b.a)(u,2),d=l[0],f=l[1];Object(r.useEffect)((function(){try{var e=(""+new v.DiceRoll(n).output).split(" = ");f(e[0].split(": ")[1]),i(e[1])}catch(t){f("Invalid formula"),i("0")}}),[n]);return Object(g.jsxs)("div",{className:"mainPage",children:[Object(g.jsx)("div",{className:"mainPageTitle",children:"Roll dice"}),Object(g.jsxs)("div",{className:"formulaInputGroup",children:[Object(g.jsx)("input",{className:"formulaInput",id:"formula",onChange:function(e){return t=e,console.log(t),void a(t.target.value);var t},value:n,placeholder:"Dice Formula"}),Object(g.jsx)("label",{htmlFor:"formula",className:"formulaInputLabel",children:"Dice formula"})]}),Object(g.jsx)("div",{className:"formulaResultDetail",children:d}),Object(g.jsx)("div",{className:"formulaResultTotal",children:s})]})}),C=n(9),w=n.n(C),E=n(27),k=n(160),y=n(164),R=n(45);n(307);function I(e){var t=e.srcObject,n=Object(y.a)(e,["srcObject"]),a=Object(r.useRef)(null);return Object(r.useEffect)((function(){console.log("video stream set"),a.current&&(a.current.srcObject=t)}),[t]),Object(g.jsx)("video",Object(k.a)({ref:a},n))}var N=function(){var e,t=Object(r.useState)(!0),n=Object(b.a)(t,2),a=n[0],c=n[1],o=Object(r.useState)(!0),s=Object(b.a)(o,2),i=s[0],u=s[1],l=Object(r.useState)(!1),d=Object(b.a)(l,2),f=d[0],h=d[1],j=Object(r.useState)(!1),p=Object(b.a)(j,2),O=p[0],m=p[1],x=Object(r.useState)(new MediaStream),v=Object(b.a)(x,2),S=v[0],C=v[1],k=Object(r.useState)(new MediaStream),y=Object(b.a)(k,2),N=y[0],D=y[1],T=Object(r.useState)(new MediaStream),L=Object(b.a)(T,2),A=L[0],B=L[1],P={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},G=Object(r.useState)(""),M=Object(b.a)(G,2),H=M[0],V=M[1];function J(){return(J=Object(E.a)(w.a.mark((function t(){var n,a,r,o,s;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c(!0),u(!0),n=R.a.firestore(),t.next=5,n.collection("rooms").doc();case 5:return a=t.sent,console.log("Create PeerConnection with configuration: ",P),e=new RTCPeerConnection(P),K(),S.getTracks().forEach((function(t){e.addTrack(t,S)})),r=a.collection("callerCandidates"),e.addEventListener("icecandidate",(function(e){e.candidate?(console.log("Got candidate: ",e.candidate),r.add(e.candidate.toJSON())):console.log("Got final candidate!")})),t.next=14,e.createOffer();case 14:return o=t.sent,t.next=17,e.setLocalDescription(o);case 17:return console.log("Created offer:",o),s={offer:{type:o.type,sdp:o.sdp}},t.next=21,a.set(s);case 21:console.log("New room created with SDP offer. Room ID: ".concat(a.id)),V(a.id),e.addEventListener("track",(function(e){console.log("Got remote track:",e.streams[0]),e.streams[0].getTracks().forEach((function(e){console.log("Add a track to the remoteStream:",e),A.addTrack(e)}))})),a.onSnapshot(function(){var t=Object(E.a)(w.a.mark((function t(n){var a,c;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.data(),e.currentRemoteDescription||!a||!a.answer){t.next=6;break}return console.log("Got remote description: ",a.answer),c=new RTCSessionDescription(a.answer),t.next=6,e.setRemoteDescription(c);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),a.collection("calleeCandidates").onSnapshot((function(t){t.docChanges().forEach(function(){var t=Object(E.a)(w.a.mark((function t(n){var a;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("added"!==n.type){t.next=5;break}return a=n.doc.data(),console.log("Got new remote ICE candidate: ".concat(JSON.stringify(a))),t.next=5,e.addIceCandidate(new RTCIceCandidate(a));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}));case 26:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _(){return(_=Object(E.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(!0),u(!0),console.log("Join room: ",H),e.next=5,z(H);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return U.apply(this,arguments)}function U(){return(U=Object(E.a)(w.a.mark((function t(n){var a,c,r,o,s,i,u,l;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=R.a.firestore(),c=a.collection("rooms").doc("".concat(n)),t.next=4,c.get();case 4:if(r=t.sent,console.log("Got room:",r.exists),!r.exists){t.next=28;break}return console.log("Create PeerConnection with configuration: ",P),e=new RTCPeerConnection(P),K(),S.getTracks().forEach((function(t){e.addTrack(t,S)})),s=c.collection("calleeCandidates"),e.addEventListener("icecandidate",(function(e){e.candidate?(console.log("Got candidate: ",e.candidate),s.add(e.candidate.toJSON())):console.log("Got final candidate!")})),e.addEventListener("track",(function(e){console.log("Got remote track:",e.streams[0]),e.streams[0].getTracks().forEach((function(e){console.log("Add a track to the remoteStream:",e),A.addTrack(e)}))})),i=null===r||void 0===r||null===(o=r.data())||void 0===o?void 0:o.offer,console.log("Got offer:",i),t.next=18,e.setRemoteDescription(new RTCSessionDescription(i));case 18:return t.next=20,e.createAnswer();case 20:return u=t.sent,console.log("Created answer:",u),t.next=24,e.setLocalDescription(u);case 24:return l={answer:{type:u.type,sdp:u.sdp}},t.next=27,c.update(l);case 27:c.collection("callerCandidates").onSnapshot((function(t){t.docChanges().forEach(function(){var t=Object(E.a)(w.a.mark((function t(n){var a;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("added"!==n.type){t.next=5;break}return a=n.doc.data(),console.log("Got new remote ICE candidate: ".concat(JSON.stringify(a))),t.next=5,e.addIceCandidate(new RTCIceCandidate(a));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}));case 28:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function F(){return(F=Object(E.a)(w.a.mark((function e(t){var n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:n=e.sent,C(n),D(new MediaStream(n.getVideoTracks())),B(new MediaStream),console.log("Stream:",S),h(!0),u(!1),c(!1),m(!1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(){return(X=Object(E.a)(w.a.mark((function t(n){var a,r;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(S.getTracks().forEach((function(e){e.stop()})),A&&A.getTracks().forEach((function(e){return e.stop()})),e&&e.close(),c(!0),u(!0),!H){t.next=19;break}return a=R.a.firestore(),r=a.collection("rooms").doc(H),t.next=11,r.collection("calleeCandidates").get();case 11:return t.sent.forEach(function(){var e=Object(E.a)(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ref.delete();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.next=15,r.collection("callerCandidates").get();case 15:return t.sent.forEach(function(){var e=Object(E.a)(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ref.delete();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.next=19,r.delete();case 19:document.location.reload(!0);case 20:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function K(){e.addEventListener("icegatheringstatechange",(function(){console.log("ICE gathering state changed: ".concat(e.iceGatheringState))})),e.addEventListener("connectionstatechange",(function(){console.log("Connection state change: ".concat(e.connectionState))})),e.addEventListener("signalingstatechange",(function(){console.log("Signaling state change: ".concat(e.signalingState))})),e.addEventListener("iceconnectionstatechange ",(function(){console.log("ICE connection state change: ".concat(e.iceConnectionState))}))}R.a.apps.length||R.a.initializeApp({apiKey:"AIzaSyC9DxmeKbSAY9HFZ2NBzVRhzN0UjxSU5Bs",authDomain:"webrtc-test-480b3.firebaseapp.com",projectId:"webrtc-test-480b3",storageBucket:"webrtc-test-480b3.appspot.com",messagingSenderId:"982478263213",appId:"1:982478263213:web:ba60f0dcc6eaf1bd60c724",measurementId:"G-CLX18X1XQD"});return Object(g.jsxs)("div",{className:"mainPage",children:[Object(g.jsx)("h2",{children:"1. Start your Webcam"}),Object(g.jsxs)("div",{className:"videos",children:[Object(g.jsxs)("span",{children:[Object(g.jsx)("h3",{children:"Local Stream"}),N&&Object(g.jsx)(I,{id:"webcamVideo",autoPlay:!0,playsInline:!0,srcObject:N})]}),Object(g.jsxs)("span",{children:[Object(g.jsx)("h3",{children:"Remote Stream"}),A&&Object(g.jsx)(I,{id:"remoteVideo",autoPlay:!0,playsInline:!0,srcObject:A})]})]}),Object(g.jsx)("button",{id:"webcamButton",disabled:f,onClick:function(e){return F.apply(this,arguments)},children:"Start webcam"}),Object(g.jsx)("h2",{children:"2. Create a new Call"}),Object(g.jsx)("button",{id:"callButton",disabled:a,onClick:function(){return J.apply(this,arguments)},children:"Create Call (offer)"}),Object(g.jsx)("h2",{children:"3. Join a Call"}),Object(g.jsx)("p",{children:"Answer the call from a different browser window or device"}),Object(g.jsx)("input",{id:"callInput",value:H,onChange:function(e){V(e.target.value)}}),Object(g.jsx)("button",{id:"answerButton",disabled:i,onClick:function(){return _.apply(this,arguments)},children:"Answer"}),Object(g.jsx)("h2",{children:"4. Hangup"}),Object(g.jsx)("button",{id:"hangupButton",disabled:O,onClick:function(e){return X.apply(this,arguments)},children:"Hangup"})]})},D=(n(303),function(){switch(j().state.currentPage){case c.ROLL_DICE:return Object(g.jsx)(S,{});case c.CHARACTER_SHEETS:return Object(g.jsx)(x,{});case c.VIDEO:return Object(g.jsx)(N,{})}return Object(g.jsx)("div",{})}),T=(n(304),function(e){var t=j().actions.setPage;return Object(g.jsx)("div",{className:"menuElement",onClick:function(){return t(e.associatedComponent)},children:e.title})}),L=(n(305),function(){return Object(g.jsxs)("div",{className:"sideMenu",children:[Object(g.jsx)(T,{title:"Roll Dice",associatedComponent:c.ROLL_DICE}),Object(g.jsx)(T,{title:"Character Sheets",associatedComponent:c.CHARACTER_SHEETS}),Object(g.jsx)(T,{title:"Video chat",associatedComponent:c.VIDEO})]})});var A=function(){return Object(g.jsxs)("div",{className:"App",children:[Object(g.jsx)(L,{}),Object(g.jsx)(D,{})]})},B=n(26),P=Object(B.d)(h);s.a.render(Object(g.jsx)(i.a,{value:P,children:Object(g.jsx)(A,{})}),document.getElementById("root"))}},[[306,1,2]]]);
//# sourceMappingURL=main.07783b44.chunk.js.map